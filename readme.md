Ansible playbook
=========

playbook.yaml - итоговый файл, который будем передавать команде ansible-playbook для запуска и выполнения плеев последовательно. На текущий момент в playbook.yaml описан один плей для группы хостов dev. 

ansible.cfg
------------

ansible.cfg - конфигурационные настройки Ansible, в котором описан путь до каталога с ролями roles_path, путь до файла inventory, пользователь по умлочанию remote_user, повышение привелегий до root. 
Так же здесь включаем кэширование сбора фактов, результатов выполнения задач (cache=true), так как сбор фактов достаточно тяжелая операция. Плагин для кэширования jsonfile, ~/.cache/ansible - каталог в котором будут хранится кэшированные данные. Таймаут срока действия данных кэша 3600 секунд, а именно по истечению данного времени закэшированные данныые будут считаться устаревшими.

Inventory file
--------------

Inventory файл имеет название hosts.txt
Для разделения инфраструктуры на окружения, разбил серерва на группы dev, test, prod.
Таким образом плейбук можно запускать с параметром --limit только по нужному окружению (в нашем случае будет dev):
ansible-playbook playbook.yaml --limit dev 

Ansible roles
------------

/roles - директория Ansible-ролей. На текущий момент реализована 5 ролей: backup_old_files, starting_service, stoping_service, update_files, uploading_archive. 

stoping_service - стопаем сервис
uploading_archive - загржаем архив и распаковываем
backup_old_files - делаем бэкапы файлов
update_files - обновляем файлы в директории
starting_service - стартуем сервис


Файловая структура ролей в основном одинаковая и состоит из:
tasks/main.yml — Ansible-задачи, запускаемые ролью. 
defaults/main.yml — дефолтные значения переменных для роли.
vars/main.yml — переменные для роли.
handlers/main.yml — обработчики, запускаются только при получении соответствующих уведомлений (notify) от задач.
meta/main.yml — метаданные с описанием авторов роли, зависимостей и версии.

Примечание
------------

Не видел большого смысла деления на несколько ролей, но так указано было в задании "Разделить единый test.yml на отдельные роли.". В целом тут можно было просто созать одну роль.
Оптимизация, которая была проведена: Описал конфигурационные настройки Ansible в ansible.cfg, включил кэширование сбора фактов, результатов выполнения задач в конфиге ansible.cfg, в файле инвентори hosts.txt для разделения инфраструктуры на окружения, разбил серерва на группы dev, test, prod, объеденил несколько тасков в один используя конструкцию with_items (task: rename, роль: backup_old_files), единый test.yml разделен на отдельные роли
